import matplotlib.pyplot as plt
import numpy as np
import control

datos = np.array([[0.00, 0.00],
                  [0.00, 3.23],
                  [0.07, 4.28],
                  [0.18, 4.69],
                  [0.32, 4.84],
                  [0.49, 4.91],
                  [0.68, 4.94],
                  [0.88, 4.97],
                  [1.10, 4.96],
                  [1.34, 4.97],
                  [1.57, 4.97],
                  [1.80, 4.97],
                  [2.02, 4.97],
                  [2.24, 4.97],
                  [2.44, 4.97],
                  [2.63, 4.97],
                  [2.83, 4.97],
                  [2.97, 4.92],
                  [3.17, 4.97],
                  [3.30, 4.97],
                  [3.42, 4.97],
                  [3.51, 4.95],
                  [3.62, 4.98],
                  [3.69, 4.98],
                  [3.75, 4.98],
                  [3.78, 4.95],
                  [3.83, 4.98],
                  [3.85, 4.98],
                  [3.85, 4.97],
                  [3.84, 4.97],
                  [3.84, 4.98],
                  [3.82, 4.97],
                  [3.76, 4.93],
                  [3.77, 4.99],
                  [3.73, 4.99],
                  [3.67, 4.95],
                  [3.65, 4.97],
                  [3.60, 4.97],
                  [3.56, 4.97],
                  [3.49, 4.94],
                  [3.47, 4.97],
                  [3.43, 4.97],
                  [3.39, 4.97],
                  [3.35, 4.97],
                  [3.31, 4.97],
                  [3.27, 4.98],
                  [3.24, 4.97],
                  [3.21, 4.98],
                  [3.16, 4.94],
                  [3.14, 4.95],
                  [3.14, 4.97],
                  [3.12, 4.97],
                  [3.10, 4.97],
                  [3.10, 4.98],
                  [3.09, 4.98],
                  [3.07, 4.95],
                  [3.08, 4.98],
                  [3.07, 4.97],
                  [3.07, 4.98],
                  [3.05, 4.95],
                  [3.07, 4.98],
                  [3.07, 4.97],
                  [3.04, 4.92],
                  [3.09, 4.98],
                  [3.09, 4.97],
                  [3.09, 4.94],
                  [3.11, 4.98],
                  [3.12, 4.97],
                  [3.12, 4.98],
                  [3.13, 4.97],
                  [3.12, 4.95],
                  [3.14, 4.98],
                  [3.15, 4.97],
                  [3.16, 4.97],
                  [3.17, 4.98],
                  [3.18, 4.97],
                  [3.18, 4.98],
                  [3.16, 4.95],
                  [3.19, 4.98],
                  [3.19, 4.98],
                  [3.20, 4.98],
                  [3.20, 4.98],
                  [3.20, 4.97],
                  [3.20, 4.97],
                  [3.22, 4.99],
                  [3.21, 4.97],
                  [3.21, 4.97],
                  [3.20, 4.96],
                  [3.21, 4.97],
                  [3.20, 4.97],
                  [3.20, 4.97],
                  [3.21, 4.98],
                  [3.18, 4.93],
                  [3.21, 4.98],
                  [3.17, 4.94],
                  [3.19, 4.98],
                  [3.19, 4.97],
                  [3.19, 4.98],
                  [3.19, 4.98],
                  [3.19, 4.97],
                  [3.19, 4.97],
                  [3.19, 4.97],
                  [3.19, 4.97],
                  [3.19, 4.97],
                  [3.19, 4.97],
                  [3.19, 4.98],
                  [3.19, 4.97],
                  [3.18, 4.98],
                  [3.19, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.16, 4.93],
                  [3.19, 4.99],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.17, 4.97],
                  [3.17, 4.97],
                  [3.15, 4.96],
                  [3.14, 4.94],
                  [3.15, 4.94],
                  [3.17, 4.98],
                  [3.14, 4.94],
                  [3.17, 4.98],
                  [3.17, 4.98],
                  [3.17, 4.97],
                  [3.17, 4.98],
                  [3.16, 4.94],
                  [3.14, 4.93],
                  [3.17, 4.98],
                  [3.18, 4.98],
                  [3.18, 4.97],
                  [3.15, 4.93],
                  [3.18, 4.97],
                  [3.16, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.16, 4.94],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.98],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.19, 4.99],
                  [3.19, 4.97],
                  [3.16, 4.94],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.19, 4.97],
                  [3.18, 4.97],
                  [3.19, 4.97],
                  [3.16, 4.94],
                  [3.18, 4.97],
                  [3.18, 4.98],
                  [3.18, 4.97],
                  [3.18, 4.96],
                  [3.18, 4.96],
                  [3.18, 4.97],
                  [3.17, 4.97],
                  [3.17, 4.97],
                  [3.17, 4.97],
                  [3.15, 4.94],
                  [3.17, 4.97],
                  [3.17, 4.97],
                  [3.17, 4.97],
                  [3.18, 4.98],
                  [3.17, 4.98],
                  [3.17, 4.97],
                  [3.17, 4.98],
                  [3.17, 4.97],
                  [3.15, 4.94],
                  [3.15, 4.96],
                  [3.15, 4.96],
                  [3.16, 4.97],
                  [3.15, 4.96],
                  [3.16, 4.96],
                  [3.18, 5.00],
                  [3.19, 5.00],
                  [3.18, 4.98],
                  [3.18, 4.98],
                  [3.19, 4.98],
                  [3.15, 4.94],
                  [3.15, 4.93],
                  [3.16, 4.94],
                  [3.19, 4.97],
                  [3.19, 4.97],
                  [3.19, 4.97],
                  [3.19, 4.99],
                  [3.19, 4.97],
                  [3.18, 4.97],
                  [3.19, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.96],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.16, 4.95],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.98],
                  [3.18, 4.98],
                  [3.16, 4.96],
                  [3.16, 4.96],
                  [3.16, 4.97],
                  [3.16, 4.96],
                  [3.16, 4.96],
                  [3.17, 4.97],
                  [3.16, 4.96],
                  [3.17, 4.96],
                  [3.17, 4.97],
                  [3.17, 4.97],
                  [3.17, 4.97],
                  [3.17, 4.96],
                  [3.18, 4.96],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.96],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.96],
                  [3.18, 4.96],
                  [3.18, 4.96],
                  [3.18, 4.96],
                  [3.18, 4.97],
                  [3.18, 4.96],
                  [3.18, 4.96],
                  [3.18, 4.96],
                  [3.18, 4.96],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.96],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.96],
                  [3.18, 4.97],
                  [3.18, 4.96],
                  [3.19, 4.97],
                  [3.20, 4.99],
                  [3.21, 4.98],
                  [3.18, 4.93],
                  [3.18, 4.93],
                  [3.20, 4.97],
                  [3.20, 4.99],
                  [3.20, 4.97],
                  [3.20, 4.97],
                  [3.20, 4.97],
                  [3.20, 4.97],
                  [3.19, 4.98],
                  [3.19, 4.97],
                  [3.19, 4.97],
                  [3.19, 4.97],
                  [3.18, 4.97],
                  [3.19, 4.99],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.15, 4.93],
                  [3.15, 4.95],
                  [3.18, 4.99],
                  [3.17, 4.98],
                  [3.17, 4.97],
                  [3.14, 4.93],
                  [3.17, 4.97],
                  [3.17, 4.97],
                  [3.17, 4.97],
                  [3.16, 4.93],
                  [3.17, 4.97],
                  [3.17, 4.98],
                  [3.17, 4.97],
                  [3.17, 4.97],
                  [3.15, 4.94],
                  [3.18, 4.96],
                  [3.17, 4.97],
                  [3.17, 4.97],
                  [3.17, 4.97],
                  [3.17, 4.97],
                  [3.18, 4.97],
                  [3.17, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.16, 4.94],
                  [3.18, 4.97],
                  [3.18, 4.99],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.18, 4.97],
                  [3.16, 4.95],
                  [3.15, 4.93],
                  [3.18, 4.98],
                  [3.18, 4.97],
                  [3.16, 4.94],
                  [3.18, 4.97],
                  [3.15, 4.93]])
ud = np.array(datos[:, 1])
yd = np.array(datos[:, 0])

data = np.array([[0.00, 0.00],
                 [0.00, 3.09],
                 [0.07, 4.20],
                 [0.17, 4.66],
                 [0.31, 4.83],
                 [0.47, 4.92],
                 [0.66, 4.92],
                 [0.88, 4.95],
                 [1.10, 4.97],
                 [1.32, 4.97],
                 [1.55, 4.98],
                 [1.77, 4.94],
                 [2.00, 4.97],
                 [2.22, 4.97],
                 [2.43, 4.97],
                 [2.65, 4.98],
                 [2.83, 4.97],
                 [3.01, 4.97],
                 [3.16, 4.97],
                 [3.30, 4.95],
                 [3.43, 4.97],
                 [3.53, 4.97],
                 [3.64, 4.98],
                 [3.71, 4.98],
                 [3.77, 4.98],
                 [3.78, 4.93],
                 [3.85, 4.97],
                 [3.84, 4.94],
                 [3.88, 4.97],
                 [3.85, 4.94],
                 [3.84, 4.94],
                 [3.84, 4.98],
                 [3.82, 4.97],
                 [3.79, 4.97],
                 [3.75, 4.97],
                 [3.68, 4.93],
                 [3.66, 4.97],
                 [3.61, 4.97],
                 [3.57, 4.97],
                 [3.51, 4.97],
                 [3.40, 4.93],
                 [3.33, 4.97],
                 [3.24, 4.97],
                 [3.15, 4.97],
                 [3.06, 4.96],
                 [3.01, 4.97],
                 [3.00, 4.98],
                 [2.98, 4.97],
                 [2.98, 4.97],
                 [2.97, 4.97],
                 [2.98, 4.98],
                 [2.97, 4.97],
                 [2.97, 4.97],
                 [2.98, 4.98],
                 [3.00, 4.97],
                 [3.02, 4.97],
                 [3.03, 4.97],
                 [3.04, 4.97],
                 [3.06, 4.97],
                 [3.07, 4.97],
                 [3.09, 4.97],
                 [3.11, 4.97],
                 [3.12, 4.98],
                 [3.14, 4.98],
                 [3.15, 4.97],
                 [3.17, 4.97],
                 [3.18, 4.97],
                 [3.19, 4.97],
                 [3.20, 4.97],
                 [3.21, 4.97],
                 [3.21, 4.97],
                 [3.21, 4.93],
                 [3.23, 4.97],
                 [3.24, 4.97],
                 [3.24, 4.97],
                 [3.25, 4.97],
                 [3.24, 4.95],
                 [3.25, 4.97],
                 [3.23, 4.95],
                 [3.25, 4.97],
                 [3.23, 4.95],
                 [3.24, 4.97],
                 [3.24, 4.96],
                 [3.24, 4.97],
                 [3.24, 4.97],
                 [3.20, 4.92],
                 [3.23, 4.99],
                 [3.22, 4.97],
                 [3.22, 4.98],
                 [3.22, 4.97],
                 [3.20, 4.95],
                 [3.23, 4.99],
                 [3.21, 4.97],
                 [3.21, 4.97],
                 [3.20, 4.97],
                 [3.20, 4.96],
                 [3.19, 4.97],
                 [3.19, 4.97],
                 [3.19, 4.97],
                 [3.19, 4.97],
                 [3.19, 4.97],
                 [3.18, 4.95],
                 [3.19, 4.98],
                 [3.16, 4.94],
                 [3.18, 4.95],
                 [3.19, 4.97],
                 [3.18, 4.98],
                 [3.19, 4.97],
                 [3.18, 4.98],
                 [3.19, 4.98],
                 [3.19, 4.97],
                 [3.16, 4.94],
                 [3.19, 4.97],
                 [3.19, 4.96],
                 [3.19, 4.97],
                 [3.19, 4.97],
                 [3.19, 4.97],
                 [3.17, 4.94],
                 [3.19, 4.97],
                 [3.20, 4.97],
                 [3.19, 4.97],
                 [3.20, 4.97],
                 [3.20, 4.97],
                 [3.20, 4.97],
                 [3.20, 4.97],
                 [3.20, 4.97],
                 [3.20, 4.97],
                 [3.20, 4.97],
                 [3.17, 4.94],
                 [3.20, 4.97],
                 [3.18, 4.94],
                 [3.17, 4.94],
                 [3.20, 4.98],
                 [3.20, 4.95],
                 [3.17, 4.93],
                 [3.20, 4.97],
                 [3.20, 4.97],
                 [3.20, 4.97],
                 [3.20, 4.97],
                 [3.20, 4.97],
                 [3.20, 4.97],
                 [3.20, 4.97],
                 [3.20, 4.97],
                 [3.20, 4.97],
                 [3.21, 4.97],
                 [3.18, 4.94],
                 [3.20, 4.97],
                 [3.20, 4.98],
                 [3.20, 4.97],
                 [3.16, 4.93],
                 [3.19, 4.97],
                 [3.18, 3.42],
                 [3.14, 2.87],
                 [3.08, 2.64],
                 [3.02, 2.54],
                 [2.93, 2.50],
                 [2.83, 2.50],
                 [2.73, 2.49],
                 [2.61, 2.48],
                 [2.51, 2.49],
                 [2.38, 2.47],
                 [2.28, 2.47],
                 [2.18, 2.50],
                 [2.07, 2.48],
                 [1.96, 2.47],
                 [1.87, 2.47],
                 [1.76, 2.47],
                 [1.69, 2.46],
                 [1.61, 2.47],
                 [1.55, 2.49],
                 [1.48, 2.48],
                 [1.43, 2.48],
                 [1.38, 2.48],
                 [1.35, 2.48],
                 [1.31, 2.47],
                 [1.30, 2.47],
                 [1.28, 2.49],
                 [1.27, 2.48],
                 [1.26, 2.46],
                 [1.27, 2.48],
                 [1.27, 2.47],
                 [1.28, 2.47],
                 [1.28, 2.47],
                 [1.30, 2.48],
                 [1.32, 2.46],
                 [1.32, 2.46],
                 [1.35, 2.47],
                 [1.38, 2.47],
                 [1.40, 2.48],
                 [1.41, 2.47],
                 [1.45, 2.48],
                 [1.47, 2.47],
                 [1.49, 2.49],
                 [1.50, 2.46],
                 [1.52, 2.46],
                 [1.55, 2.49],
                 [1.56, 2.48],
                 [1.58, 2.47],
                 [1.60, 2.49],
                 [1.61, 2.48],
                 [1.62, 2.47],
                 [1.63, 2.48],
                 [1.64, 2.47],
                 [1.64, 2.47],
                 [1.65, 2.48],
                 [1.66, 2.48],
                 [1.64, 2.47],
                 [1.66, 2.48],
                 [1.66, 2.48],
                 [1.65, 2.47],
                 [1.66, 2.48],
                 [1.66, 2.47],
                 [1.66, 2.47],
                 [1.66, 2.48],
                 [1.65, 2.47],
                 [1.64, 2.47],
                 [1.65, 2.48],
                 [1.64, 2.47],
                 [1.64, 2.49],
                 [1.63, 2.48],
                 [1.63, 2.47],
                 [1.63, 2.48],
                 [1.62, 2.49],
                 [1.62, 2.47],
                 [1.62, 2.47],
                 [1.61, 2.49],
                 [1.60, 2.46],
                 [1.60, 2.47],
                 [1.60, 2.48],
                 [1.60, 2.49],
                 [1.60, 2.47],
                 [1.60, 2.47],
                 [1.60, 2.48],
                 [1.59, 2.47],
                 [1.58, 2.45],
                 [1.58, 2.46],
                 [1.59, 2.49],
                 [1.59, 2.48],
                 [1.59, 2.47],
                 [1.58, 2.47],
                 [1.59, 2.48],
                 [1.59, 2.47],
                 [1.59, 2.49],
                 [1.59, 2.49],
                 [1.59, 2.48],
                 [1.58, 2.46],
                 [1.59, 2.48],
                 [1.58, 2.47],
                 [1.58, 2.46],
                 [1.58, 2.46],
                 [1.60, 2.48],
                 [1.60, 2.48],
                 [1.60, 2.49],
                 [1.60, 2.48],
                 [1.60, 2.46],
                 [1.59, 2.47],
                 [1.60, 2.47],
                 [1.60, 2.47],
                 [1.59, 2.46],
                 [1.60, 2.48],
                 [1.60, 2.49],
                 [1.60, 2.48],
                 [1.60, 2.47],
                 [1.60, 2.49],
                 [1.59, 2.46],
                 [1.60, 2.47],
                 [1.60, 2.47],
                 [1.60, 2.49],
                 [1.60, 2.48],
                 [1.60, 2.47],
                 [1.60, 2.48],
                 [1.60, 2.48],
                 [1.60, 2.47],
                 [1.59, 2.45],
                 [1.59, 2.46],
                 [1.60, 2.49],
                 [1.61, 2.48],
                 [1.59, 2.45],
                 [1.60, 2.47],
                 [1.60, 2.48],
                 [1.60, 2.47],
                 [1.58, 2.46],
                 [1.60, 2.48],
                 [1.60, 2.48],
                 [1.60, 2.47],
                 [1.60, 2.47],
                 [1.60, 2.48],
                 [1.60, 2.47],
                 [1.60, 2.47],
                 [1.59, 2.47],
                 [1.60, 2.48],
                 [1.60, 2.48],
                 [1.60, 2.46],
                 [1.60, 2.47],
                 [1.60, 2.48],
                 [1.60, 2.47],
                 [1.60, 2.48],
                 [1.60, 2.49],
                 [1.60, 2.49],
                 [1.60, 2.49]])
print(len(data))

T = 0.1
t = np.arange(0, len(data) * T, T)
td = np.arange(0, len(datos) * T, T)
u = np.array(data[:, 1])
y = np.array(data[:, 0])
l = len(y)  # l es la cantidad de muestras
m = 4  # m es el orden de la planta a parametrizar en z
n = l - m  # n es la dimension principal del sistema de matrices
Theta = np.zeros(shape=(n, 1))
F = np.zeros(shape=(n, (2 * m) + 1))
Ft = np.zeros(shape=((2 * m) + 1, n))
b = np.zeros(shape=((2 * m) + 1, 1))

# Graficacion de referencia y respuesta
plt.plot(t, y)
plt.plot(t, u)
plt.show()

# Cálculo de la matriz F
for i in range((2 * m) + 1):
    if i < m:
        F[:, i] = (-1) * y[m - 1 - i:l - 1 - i]
    else:
        F[:, i] = u[(2 * m) - i:l - i + m]

# Vector b
b = y[m:l]

# Matriz F transpuesta
Ft = F.transpose()

# Cálculo de matriz inversa
Fseudo = Ft.dot(F)  # multiplicación de FtxF
FseudoInv = np.linalg.inv(Fseudo)  # Inversa de la multiplicación
Theta = FseudoInv.dot(Ft.dot(b))  # Cálculo de los párametros del modelo
print(Theta)

plt.plot(t, y)
# Construcción de la función de transferencia
num = Theta[m:(2 * m) + 1]
den = [1]
den.extend(Theta[0:m])
print(num)
print(den)
Hz = control.tf(num, den, T)
print(Hz)
(t1, y1) = control.step_response(Hz, t)
y1 = y1 * 5
plt.step(t1, y1)
plt.show()

plt.plot(td, yd)
plt.step(t1, y1)
plt.show()

Hs = control.tf([1], [1, 1, 1.5])
print(Hs)
(t2, y2) = control.step_response(Hs, t)
y1 = y1 / 5
plt.step(t1, y1)
plt.plot(t2, y2)
plt.show()

y2 = y2 * 5
plt.plot(td, yd)
plt.plot(t2, y2)
plt.show()
